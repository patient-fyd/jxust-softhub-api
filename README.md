# 江西应用科技学院软件协会官网后端API服务

## 项目简介

本项目是江西应用科技学院软件协会官网和后台管理系统的后端API服务，基于GoFrameV2框架开发。主要提供新闻管理、会员管理、活动管理、文件管理等功能的接口服务。

## 技术栈

- **开发语言**：Go v1.18+
- **框架**：GoFrame v2.x
- **数据库**：MySQL 5.7+
- **缓存**：Redis
- **鉴权**：JWT + RBAC 权限模型
- **ORM**：GoFrame ORM
- **API风格**：RESTful
- **日志系统**：GoFrame 自带 g.Log + 业务审计日志

## 功能模块

本项目包含以下主要功能模块：

1. **认证模块**
   - 用户注册
   - 用户登录
   - 管理员登录
   - Token刷新

2. **用户模块**
   - 获取用户信息
   - 获取用户列表
   - 分配用户角色

3. **会员申请模块**
   - 提交加入申请
   - 获取申请列表
   - 获取申请详情
   - 审核申请

4. **新闻模块**
   - 获取新闻列表
   - 获取新闻详情
   - 创建新闻
   - 更新新闻
   - 删除新闻

5. **社区功能模块**
   - **帖子管理**
     - 获取帖子列表
     - 获取帖子详情
     - 发布帖子
     - 删除帖子
   - **评论管理**
     - 获取评论列表
     - 发表评论
     - 删除评论
     - 评论内容过滤
     - 用户评论权限控制
   - **点赞功能**
     - 点赞/取消点赞
   - **关注功能**
     - 关注/取消关注
     - 获取关注列表
     - 获取粉丝列表
   - **圈子管理**
     - 获取圈子列表
     - 获取圈子详情
   - **话题管理**
     - 获取话题列表

## 评论功能详细说明

评论功能支持对帖子内容进行评论交流，支持以下主要功能：

### 评论列表查询

可根据内容类型和ID查询对应的评论列表，支持分页查询。评论按时间倒序排列，同时返回评论的点赞数量和当前用户是否已点赞信息。

**接口路径**: `/api/comment/v1/list`  
**请求方式**: GET

### 发表评论

登录用户可对帖子发表评论，系统会自动关联评论者信息，并更新帖子的评论计数。

**接口路径**: `/api/comment/v1/create`  
**请求方式**: POST

### 删除评论

评论作者和管理员可以删除评论，删除评论时会同步清理评论相关的点赞记录，并更新帖子的评论数量。

**接口路径**: `/api/comment/v1/delete`  
**请求方式**: POST

### 评论权限控制

- 游客可查看评论，但不能发表和删除评论
- 登录用户可发表评论和删除自己的评论
- 管理员可删除任何评论

### 相关数据库表

- **comments表**: 存储评论信息
- **likes表**: 存储点赞信息，支持对评论点赞

## 点赞功能详细说明

点赞功能支持对帖子和评论进行点赞，具有以下特性：

### 点赞/取消点赞

用户可以对帖子和评论进行点赞或取消点赞，系统会自动更新目标的点赞数量。

**接口路径**: `/api/like/v1/toggle`  
**请求方式**: POST

### 点赞权限控制

- 只有登录用户才能进行点赞操作
- 用户可以查看帖子和评论的点赞数量
- 系统会记录用户的点赞状态，每个用户对同一目标只能点赞一次

### 相关数据库表

- **likes表**: 存储用户点赞记录，包含用户ID、目标ID、目标类型、创建时间等信息
- **posts表和comments表**: 包含点赞计数字段，实时反映点赞数量

## 关注功能详细说明

关注功能支持用户之间和用户对圈子的关注关系管理，具有以下特性：

### 关注/取消关注

用户可以关注其他用户或圈子，也可以取消关注关系。系统会自动更新被关注对象的粉丝数量和用户的关注数量。

**接口路径**: `/api/follow/v1/toggle`  
**请求方式**: POST

### 获取关注列表

获取指定用户关注的用户或圈子列表，支持分页查询。

**接口路径**: `/api/follow/v1/following/list`  
**请求方式**: GET

### 获取粉丝列表

获取指定用户的粉丝列表，支持分页查询。

**接口路径**: `/api/follow/v1/follower/list`  
**请求方式**: GET

### 关注权限控制

- 只有登录用户才能进行关注操作
- 用户不能关注自己
- 系统会记录关注状态，支持识别互相关注的用户

### 相关数据库表

- **follows表**: 存储用户关注记录，包含用户ID、被关注对象ID、关注类型、创建时间等信息
- **users表**: 包含粉丝数量(followerCount)和关注数量(followingCount)字段，由触发器自动维护
- **circles表**: 包含关注者数量(followerCount)字段

## 项目结构

```sh
├── api             # 对外接口定义
├── cmd             # 命令行工具
├── internal        # 内部实现
│   ├── controller  # 控制器层
│   ├── logic       # 业务逻辑层
│   ├── model       # 数据模型层
│   ├── service     # 服务接口层
│   └── dao         # 数据访问层
├── manifest        # 配置文件
│   ├── config      # 配置项
│   ├── deploy      # 部署配置
│   └── sql         # SQL脚本
└── utility         # 工具库
```

## 开发指南

### 环境要求

- Go 1.18+
- MySQL 5.7+
- Redis

### 初始化数据库

```bash
# 执行SQL脚本
mysql -uroot -p'your_password' < manifest/sql/jxust_softhub.sql
```

### 安装依赖

```bash
go mod tidy
```

### 运行项目

```bash
# 开发环境
make run

# 生产环境
GF_GCFG_FILE=config.prod.yaml ./jxust-softhub-api-api
```

### 代码生成

```bash
# 生成数据访问层代码
make dao

# 生成控制器代码
make ctrl

# 生成服务接口代码
make service
```

## API文档

项目内置Swagger文档，运行项目后访问：

```
http://localhost:8000/swagger
```

## 部署指南

### Docker部署

```bash
# 构建镜像
docker build -t jxust-softhub-api .

# 运行容器
docker run -d -p 8000:8000 \
  -e GF_GCFG_FILE=config.prod.yaml \
  --name jxust-softhub-api \
  jxust-softhub-api
```

## 贡献指南

欢迎提交PR或Issue，共同改进项目质量！

## 版权信息

Copyright © 2024 江西应用科技学院软件协会 